name: Notify Telegram

on:
  workflow_run:
    workflows: ["Deploy", "Build", "CI"]
    types: [completed]

  workflow_dispatch:   # ‚Üê manual trigger dari GitHub UI
    inputs:
      message:
        description: "Optional custom message"
        required: false
        default: "Manual trigger executed"

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send manual trigger info
        if: github.event_name == 'workflow_dispatch'
        run: |
          MESSAGE="üß™ Manual workflow trigger

Repo: ${{ github.repository }}
Actor: ${{ github.actor }}
Message: ${{ github.event.inputs.message }}"

          curl -s -X POST https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage \
            -H "Content-Type: application/json" \
            -d "{
              \"chat_id\": \"${{ secrets.CHAT_ID }}\",
              \"text\": \"$MESSAGE\"
            }"

      - name: Workflow run notification
        if: github.event_name == 'workflow_run'
        run: |
          STATUS="${{ github.event.workflow_run.conclusion }}"
          WORKFLOW="${{ github.event.workflow_run.name }}"
          BRANCH="${{ github.event.workflow_run.head_branch }}"
          URL="${{ github.event.workflow_run.html_url }}"

          MESSAGE="ü§ñ Deployment result

Workflow: $WORKFLOW
Branch: $BRANCH
Status: $STATUS

$URL"

          curl -s -X POST https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage \
            -H "Content-Type: application/json" \
            -d "{
              \"chat_id\": \"${{ secrets.CHAT_ID }}\",
              \"text\": \"$MESSAGE\"
            }"
